<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<title>Analytics Implementation Tracker — near-intents.org</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f8f9fa; color: #1a1a2e; padding: 32px 24px; line-height: 1.5;
  }
  .container { max-width: 1520px; margin: 0 auto; }
  h1 { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
  .subtitle { color: #6b7280; font-size: 14px; margin-bottom: 24px; }
  .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; margin-bottom: 20px; }
  .stat-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 14px 16px; text-align: center; }
  .stat-num { font-size: 28px; font-weight: 700; }
  .stat-num.green { color: #16a34a; } .stat-num.amber { color: #d97706; }
  .stat-num.gray { color: #9ca3af; } .stat-num.blue { color: #2563eb; }
  .stat-label { font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 2px; }
  .progress-bar-wrap { background: #e5e7eb; border-radius: 8px; height: 10px; margin-bottom: 6px; overflow: hidden; }
  .progress-segments { display: flex; height: 100%; }
  .seg-done { background: #22c55e; } .seg-partial { background: #fbbf24; }
  .progress-text { font-size: 13px; color: #6b7280; margin-bottom: 24px; text-align: right; }
  .legend {
    display: flex; gap: 14px; flex-wrap: wrap; background: #fff; border: 1px solid #e5e7eb;
    border-radius: 10px; padding: 12px 18px; margin-bottom: 14px; font-size: 12px; align-items: center;
  }
  .legend-title { font-weight: 600; color: #374151; }
  .legend-item { display: flex; align-items: center; gap: 5px; }
  .swatch { width: 14px; height: 14px; border-radius: 3px; display: inline-block; flex-shrink: 0; }
  .legend-sep { width: 1px; height: 20px; background: #e5e7eb; }
  .ptag {
    display: inline-flex; align-items: center; gap: 3px;
    padding: 2px 7px; border-radius: 4px; font-size: 10px; font-weight: 600; white-space: nowrap;
  }
  .ptag-mp { background: #f3e8ff; color: #7c3aed; border: 1px solid #ddd6fe; }
  .ptag-ga { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
  .table-wrap { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; overflow-x: auto; margin-bottom: 24px; }
  table { width: 100%; border-collapse: collapse; font-size: 12px; }
  thead th {
    background: #f9fafb; border-bottom: 2px solid #e5e7eb; padding: 9px 10px;
    text-align: left; font-weight: 600; color: #374151; position: sticky; top: 0; z-index: 2; white-space: nowrap;
  }
  tbody td { padding: 6px 10px; border-bottom: 1px solid #f3f4f6; vertical-align: top; }
  tbody tr:hover td { background: #fafbfc !important; }
  tr.row-done td { background: #f0fdf4; } tr.row-partial td { background: #fffbeb; } tr.row-todo td { background: #fff; }
  .cat-row td {
    background: #f0f4ff !important; font-weight: 700; color: #1e40af;
    padding: 9px 10px; font-size: 12px; letter-spacing: 0.02em; border-bottom: 2px solid #dbeafe;
  }
  .badge { display: inline-block; padding: 1px 8px; border-radius: 10px; font-size: 10px; font-weight: 600; white-space: nowrap; cursor: pointer; user-select: none; }
  .badge-done { background: #dcfce7; color: #166534; }
  .badge-partial { background: #fef3c7; color: #92400e; }
  .badge-todo { background: #f3f4f6; color: #9ca3af; }
  .badge-pr { background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; font-size: 10px; font-weight: 600; padding: 1px 7px; border-radius: 10px; display: inline-block; white-space: nowrap; }
  .badge-pr-no { color: #d1d5db; font-size: 10px; }
  .cb { width: 15px; height: 15px; accent-color: #22c55e; cursor: pointer; }
  .param {
    display: inline-block; padding: 1px 5px; border-radius: 3px; font-size: 10.5px;
    margin: 1px 1px; font-family: 'SF Mono','Fira Code','Consolas',monospace; white-space: nowrap;
  }
  .param-green { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
  .param-orange { background: #fff3e0; color: #9a3412; border: 1px solid #fed7aa; }
  .param-red { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
  .param-gray { background: #f3f4f6; color: #6b7280; border: 1px solid #e5e7eb; }
  .param-blue { background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; }
  .ev-name { font-family: 'SF Mono','Fira Code','Consolas',monospace; font-weight: 600; font-size: 11px; }
  .current-name { font-family: 'SF Mono','Fira Code','Consolas',monospace; font-size: 10.5px; padding: 2px 5px; border-radius: 4px; display: inline-block; }
  .cn-match { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
  .cn-diff { background: #fff3e0; color: #9a3412; border: 1px solid #fed7aa; }
  .not-impl { color: #d1d5db; font-style: italic; font-size: 11px; }
  .complete-mark { color: #22c55e; font-size: 11px; font-weight: 500; }
  .filters { display: flex; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; align-items: center; }
  .filter-btn {
    padding: 5px 13px; border-radius: 6px; border: 1px solid #d1d5db;
    background: #fff; color: #374151; font-size: 11.5px; cursor: pointer; font-weight: 500; transition: all 0.15s;
  }
  .filter-btn:hover { border-color: #9ca3af; background: #f9fafb; }
  .filter-btn.active { background: #1e40af; color: #fff; border-color: #1e40af; }
  .filter-count { font-size: 11px; color: #9ca3af; margin-left: 12px; }
  .notes { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px 20px; margin-bottom: 24px; font-size: 12.5px; color: #4b5563; }
  .notes h3 { font-size: 14px; margin-bottom: 8px; color: #1a1a2e; }
  .notes ul { padding-left: 20px; } .notes li { margin-bottom: 4px; }
  .notes code { background: #f3f4f6; padding: 1px 4px; border-radius: 3px; font-size: 11.5px; }
  @media (max-width: 900px) { body { padding: 16px 8px; } .stats { grid-template-columns: repeat(2,1fr); } }
</style>
</head>
<body>
<div class="container">
  <h1>Analytics Implementation Tracker</h1>
  <p class="subtitle">near-intents.org &mdash; Last verified: Feb 10, 2026</p>

  <div class="stats">
    <div class="stat-card"><div class="stat-num green" id="statDone">0</div><div class="stat-label">Done</div></div>
    <div class="stat-card"><div class="stat-num amber" id="statPartial">0</div><div class="stat-label">Partial</div></div>
    <div class="stat-card"><div class="stat-num gray" id="statTodo">0</div><div class="stat-label">To Do</div></div>
    <div class="stat-card"><div class="stat-num blue" id="statPct">0%</div><div class="stat-label">Coverage</div></div>
    <div class="stat-card"><div class="stat-num" style="color:#1e40af" id="statPR">0</div><div class="stat-label">This PR</div></div>
  </div>

  <div class="progress-bar-wrap"><div class="progress-segments"><div class="seg-done" id="segDone"></div><div class="seg-partial" id="segPartial"></div></div></div>
  <div class="progress-text" id="progressText"></div>

  <div class="legend">
    <span class="legend-title">Params:</span>
    <span class="legend-item"><span class="swatch" style="background:#dcfce7;border:1px solid #bbf7d0"></span> Match</span>
    <span class="legend-item"><span class="swatch" style="background:#fff3e0;border:1px solid #fed7aa"></span> Renamed (hover)</span>
    <span class="legend-item"><span class="swatch" style="background:#eff6ff;border:1px solid #bfdbfe"></span> Extra bonus</span>
    <span class="legend-item"><span class="swatch" style="background:#fef2f2;border:1px solid #fecaca"></span> Missing</span>
    <span class="legend-sep"></span>
    <span class="legend-title">Rows:</span>
    <span class="legend-item"><span class="swatch" style="background:#f0fdf4;border:1px solid #bbf7d0"></span> Done</span>
    <span class="legend-item"><span class="swatch" style="background:#fffbeb;border:1px solid #fde68a"></span> Partial</span>
    <span class="legend-item"><span class="swatch" style="background:#fff;border:1px solid #e5e7eb"></span> To do</span>
    <span class="legend-sep"></span>
    <span class="legend-title">Platform:</span>
    <span class="legend-item"><span class="ptag ptag-mp">Mixpanel</span></span>
    <span class="legend-item"><span class="ptag ptag-ga">GA4</span></span>
  </div>

  <div class="filters">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="done">Done</button>
    <button class="filter-btn" data-filter="partial">Partial</button>
    <button class="filter-btn" data-filter="todo">To Do</button>
    <button class="filter-btn" data-filter="pr" style="border-color:#bfdbfe;color:#1e40af">This PR</button>
    <span class="filter-count" id="filterCount"></span>
  </div>

  <div class="table-wrap">
    <table>
      <thead><tr>
        <th style="width:30px"></th><th style="width:28px">#</th><th style="width:52px">Status</th>
        <th>Plan Event</th><th>Plan Parameters</th><th>Platform</th>
        <th>Current Event</th><th>Current Parameters</th><th>Missing</th><th style="width:52px">This PR</th>
      </tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <div class="notes">
    <h3>Platform Setup</h3>
    <ul>
      <li><strong>Mixpanel</strong> — Requires <code>NEXT_PUBLIC_MIXPANEL_TOKEN</code> env var. SDK events go through <code>emitEvent()</code> → EventBus → <code>useMixpanelBus</code>. Auth events call <code>mixPanel?.track()</code> directly. Auto page views disabled.</li>
      <li><strong>GA4</strong> — Pre-existing, not modified by this PR. Auto page views only.</li>
    </ul>
    <h3 style="margin-top:12px">Implementation Notes</h3>
    <ul>
      <li><strong>PII:</strong> Wallet addresses are SHA-256 hashed via <code>hashForAnalytics()</code> before sending. Hash is one-way but deterministic (same address → same hash), so it can be used for user-level grouping.</li>
      <li><strong>Amounts:</strong> Sent as raw token units (not USD-converted). Token symbol is always included so values can be interpreted.</li>
      <li><strong>Orange params:</strong> Data matches the plan but uses a different param name (kept for Mixpanel backwards compat). Hover to see the plan name mapping.</li>
      <li><strong>Extra events</strong> (not in plan): <code>wallet_verified</code>, <code>wallet_bypassed</code> in WalletVerificationProvider — tracks passkey verification flow.</li>
    </ul>
  </div>
</div>

<script>
const D=[
{cat:"1. Acquisition & Onboarding",planEvent:"page_view",planParams:["page_path","referrer","utm_*"],purpose:"Traffic sources",platform:"both",curEvent:"page_changed",curParams:[{n:"target_page",s:"orange",map:"page_path"},{n:"referrer_page",s:"orange",map:"referrer"}],missing:["utm_*"],status:"partial",pr:true},
{cat:"1. Acquisition & Onboarding",planEvent:"auth_method_presented",planParams:["is_existing_user","default_option"],purpose:"What users see first",platform:"mp",curEvent:null,curParams:[],missing:["is_existing_user","default_option"],status:"todo"},
{cat:"1. Acquisition & Onboarding",planEvent:"account_created",planParams:["auth_method","referral_source","from_gift_link"],purpose:"New user acquisition",platform:"mp",curEvent:null,curParams:[],missing:["auth_method","referral_source","from_gift_link"],status:"todo"},
{cat:"1. Acquisition & Onboarding",planEvent:"onboarding_step_viewed",planParams:["step_number","step_name","auth_method"],purpose:"Onboarding completion",platform:"mp",curEvent:null,curParams:[],missing:["step_number","step_name","auth_method"],status:"todo"},
{cat:"1. Acquisition & Onboarding",planEvent:"onboarding_completed",planParams:["time_to_complete","auth_method"],purpose:"Onboarding success",platform:"mp",curEvent:null,curParams:[],missing:["time_to_complete","auth_method"],status:"todo"},
{cat:"1. Acquisition & Onboarding",planEvent:"onboarding_abandoned",planParams:["last_step","time_spent","auth_method"],purpose:"Drop-off points",platform:"mp",curEvent:null,curParams:[],missing:["last_step","time_spent","auth_method"],status:"todo"},
{cat:"2. Auth — Passkey",planEvent:"passkey_signup_started",planParams:["device_type","browser"],purpose:"Passkey interest",platform:"mp",curEvent:null,curParams:[],missing:["device_type","browser"],status:"todo"},
{cat:"2. Auth — Passkey",planEvent:"passkey_created",planParams:["device_type","browser","time_to_complete"],purpose:"Successful passkey setup",platform:"mp",curEvent:null,curParams:[],missing:["device_type","browser","time_to_complete"],status:"todo"},
{cat:"2. Auth — Passkey",planEvent:"passkey_creation_failed",planParams:["error_type","device_type","browser"],purpose:"Passkey friction",platform:"mp",curEvent:null,curParams:[],missing:["error_type","device_type","browser"],status:"todo"},
{cat:"2. Auth — Passkey",planEvent:"passkey_login",planParams:["device_type","is_returning_user"],purpose:"Passkey usage",platform:"mp",curEvent:null,curParams:[],missing:["device_type","is_returning_user"],status:"todo"},
{cat:"2. Auth — Passkey",planEvent:"passkey_login_failed",planParams:["error_type","device_type"],purpose:"Login issues",platform:"mp",curEvent:null,curParams:[],missing:["error_type","device_type"],status:"todo"},
{cat:"2. Auth — Web3 Wallet",planEvent:"wallet_connect_started",planParams:["wallet_type","is_existing_user"],purpose:"Wallet auth choice",platform:"mp",curEvent:null,curParams:[],missing:["wallet_type","is_existing_user"],status:"todo"},
{cat:"2. Auth — Web3 Wallet",planEvent:"wallet_connect_success",planParams:["wallet_type","chain","is_existing_user"],purpose:"Successful connections",platform:"mp",curEvent:"wallet_connection_success",curParams:[{n:"wallet_type",s:"green"},{n:"chain",s:"green"},{n:"wallet_address_hash",s:"blue"},{n:"timestamp",s:"blue"}],missing:["is_existing_user"],status:"partial",pr:true},
{cat:"2. Auth — Web3 Wallet",planEvent:"wallet_connect_failed",planParams:["wallet_type","error_type"],purpose:"Connection friction",platform:"mp",curEvent:null,curParams:[],missing:["wallet_type","error_type"],status:"todo"},
{cat:"2. Auth — Web3 Wallet",planEvent:"wallet_login",planParams:["wallet_type","is_returning_user"],purpose:"Wallet re-auth",platform:"mp",curEvent:null,curParams:[],missing:["wallet_type","is_returning_user"],status:"todo"},
{cat:"2. Auth — Web3 Wallet",planEvent:"privacy_warning_displayed",planParams:["context"],purpose:"Warning shown",platform:"mp",curEvent:null,curParams:[],missing:["context"],status:"todo"},
{cat:"2. Auth — Web3 Wallet",planEvent:"privacy_warning_acknowledged",planParams:["proceeded_anyway","time_on_warning"],purpose:"Privacy response",platform:"mp",curEvent:null,curParams:[],missing:["proceeded_anyway","time_on_warning"],status:"todo"},
{cat:"2. Auth — Web3 Wallet",planEvent:"privacy_warning_learn_more",planParams:["—"],purpose:"Understanding risk",platform:"mp",curEvent:null,curParams:[],missing:[],status:"todo"},
{cat:"2. Auth — Migration",planEvent:"auth_method_selected",planParams:["method","is_new_user","was_recommended_passkey"],purpose:"What users choose",platform:"mp",curEvent:null,curParams:[],missing:["method","is_new_user","was_recommended_passkey"],status:"todo"},
{cat:"2. Auth — Migration",planEvent:"passkey_upgrade_prompted",planParams:["current_auth_method","account_age_days","balance_usd"],purpose:"Migration prompts",platform:"mp",curEvent:null,curParams:[],missing:["current_auth_method","account_age_days","balance_usd"],status:"todo"},
{cat:"2. Auth — Migration",planEvent:"passkey_upgrade_started",planParams:["previous_auth_method"],purpose:"Migration interest",platform:"mp",curEvent:null,curParams:[],missing:["previous_auth_method"],status:"todo"},
{cat:"2. Auth — Migration",planEvent:"passkey_upgrade_completed",planParams:["previous_auth_method","time_to_complete"],purpose:"Successful migrations",platform:"mp",curEvent:null,curParams:[],missing:["previous_auth_method","time_to_complete"],status:"todo"},
{cat:"2. Auth — Migration",planEvent:"passkey_upgrade_dismissed",planParams:["dismiss_reason","times_prompted"],purpose:"Migration resistance",platform:"mp",curEvent:null,curParams:[],missing:["dismiss_reason","times_prompted"],status:"todo"},
{cat:"3. Deposits",planEvent:"deposit_started",planParams:["source_chain","asset","amount_usd"],purpose:"Intent to deposit",platform:"mp",curEvent:"deposit_initiated",curParams:[{n:"network",s:"orange",map:"source_chain"},{n:"token",s:"orange",map:"asset"},{n:"amount",s:"orange",map:"amount_usd"}],missing:[],status:"done",pr:true},
{cat:"3. Deposits",planEvent:"deposit_address_copied",planParams:["source_chain","asset"],purpose:"User initiated deposit",platform:"mp",curEvent:null,curParams:[],missing:["source_chain","asset"],status:"todo"},
{cat:"3. Deposits",planEvent:"deposit_completed",planParams:["source_chain","asset","amount_usd","time_to_confirm"],purpose:"Successful deposits",platform:"mp",curEvent:"deposit_success",curParams:[{n:"network",s:"orange",map:"source_chain"},{n:"token",s:"orange",map:"asset"},{n:"amount",s:"orange",map:"amount_usd"}],missing:["time_to_confirm"],status:"partial",pr:true},
{cat:"3. Deposits",planEvent:"deposit_failed",planParams:["source_chain","asset","error_type"],purpose:"Deposit issues",platform:"mp",curEvent:"deposit_failed",curParams:[{n:"network",s:"orange",map:"source_chain"},{n:"token",s:"orange",map:"asset"},{n:"amount",s:"blue"},{n:"error_reason",s:"orange",map:"error_type"}],missing:[],status:"done",pr:true},
{cat:"3. Deposits",planEvent:"first_deposit",planParams:["source_chain","asset","amount_usd"],purpose:"Critical activation",platform:"mp",curEvent:null,curParams:[],missing:["source_chain","asset","amount_usd"],status:"todo"},
{cat:"3. Withdrawals",planEvent:"withdrawal_started",planParams:["dest_chain","asset","amount_usd"],purpose:"Intent to withdraw",platform:"mp",curEvent:"withdrawal_initiated",curParams:[{n:"to_chain",s:"orange",map:"dest_chain"},{n:"token",s:"orange",map:"asset"},{n:"amount",s:"orange",map:"amount_usd"}],missing:[],status:"done",pr:true},
{cat:"3. Withdrawals",planEvent:"withdrawal_address_entered",planParams:["dest_chain","is_contact","is_new_address"],purpose:"Address source",platform:"mp",curEvent:null,curParams:[],missing:["dest_chain","is_contact","is_new_address"],status:"todo"},
{cat:"3. Withdrawals",planEvent:"withdrawal_confirmed",planParams:["dest_chain","asset","amount_usd","fee_usd"],purpose:"Successful withdrawals",platform:"mp",curEvent:"withdrawal_confirmed",curParams:[{n:"destination_chain",s:"orange",map:"dest_chain"},{n:"token",s:"orange",map:"asset"},{n:"amount",s:"orange",map:"amount_usd"},{n:"fee",s:"orange",map:"fee_usd"}],missing:[],status:"done",pr:true},
{cat:"3. Withdrawals",planEvent:"withdrawal_failed",planParams:["dest_chain","asset","error_type"],purpose:"Withdrawal issues",platform:"mp",curEvent:"withdrawal_failed",curParams:[{n:"to_chain",s:"orange",map:"dest_chain"},{n:"token",s:"orange",map:"asset"},{n:"amount",s:"blue"},{n:"error_reason",s:"orange",map:"error_type"}],missing:[],status:"done",pr:true},
{cat:"4. Cross-Chain Swaps",planEvent:"swap_quote_requested",planParams:["from_asset","to_asset","amount_usd"],purpose:"Swap interest",platform:"mp",curEvent:null,curParams:[],missing:["from_asset","to_asset","amount_usd"],status:"todo"},
{cat:"4. Cross-Chain Swaps",planEvent:"swap_quote_received",planParams:["from_asset","to_asset","slippage","quote_time_ms"],purpose:"Quote performance",platform:"mp",curEvent:null,curParams:[],missing:["from_asset","to_asset","slippage","quote_time_ms"],status:"todo"},
{cat:"4. Cross-Chain Swaps",planEvent:"swap_initiated",planParams:["from_asset","to_asset","amount_usd"],purpose:"Swap commitment",platform:"mp",curEvent:"swap_initiated",curParams:[{n:"token_from",s:"orange",map:"from_asset"},{n:"token_to",s:"orange",map:"to_asset"},{n:"tokenDeltas",s:"orange",map:"amount_usd"}],missing:[],status:"done",pr:true},
{cat:"4. Cross-Chain Swaps",planEvent:"swap_completed",planParams:["from_asset","to_asset","amount_usd","execution_time","actual_slippage"],purpose:"Successful swaps",platform:"mp",curEvent:"swap_confirmed",curParams:[{n:"token_from",s:"orange",map:"from_asset"},{n:"token_to",s:"orange",map:"to_asset"},{n:"tokenDeltas",s:"orange",map:"amount_usd"}],missing:["execution_time","actual_slippage"],status:"partial",pr:true},
{cat:"4. Cross-Chain Swaps",planEvent:"swap_failed",planParams:["from_asset","to_asset","error_type","stage"],purpose:"Swap issues",platform:"mp",curEvent:"swap_failed",curParams:[{n:"token_from",s:"orange",map:"from_asset"},{n:"token_to",s:"orange",map:"to_asset"},{n:"error_reason",s:"orange",map:"error_type"}],missing:["stage"],status:"partial",pr:true},
{cat:"4. Cross-Chain Swaps",planEvent:"swap_abandoned",planParams:["from_asset","to_asset","stage","reason"],purpose:"Drop-off analysis",platform:"mp",curEvent:null,curParams:[],missing:["from_asset","to_asset","stage","reason"],status:"todo"},
{cat:"5. Yield",planEvent:"yield_viewed",planParams:["asset","apy_displayed"],purpose:"Interest in yield",platform:"mp",curEvent:null,curParams:[],missing:["asset","apy_displayed"],status:"todo"},
{cat:"5. Yield",planEvent:"yield_deposit_started",planParams:["asset","amount_usd","apy"],purpose:"Intent to earn",platform:"mp",curEvent:null,curParams:[],missing:["asset","amount_usd","apy"],status:"todo"},
{cat:"5. Yield",planEvent:"yield_deposit_completed",planParams:["asset","amount_usd","apy"],purpose:"Yield activation",platform:"mp",curEvent:null,curParams:[],missing:["asset","amount_usd","apy"],status:"todo"},
{cat:"5. Yield",planEvent:"yield_withdrawal_started",planParams:["asset","amount_usd","earnings_usd"],purpose:"Yield exit",platform:"mp",curEvent:null,curParams:[],missing:["asset","amount_usd","earnings_usd"],status:"todo"},
{cat:"5. Yield",planEvent:"yield_withdrawal_completed",planParams:["asset","amount_usd","earnings_usd","duration_days"],purpose:"Yield lifecycle",platform:"mp",curEvent:null,curParams:[],missing:["asset","amount_usd","earnings_usd","duration_days"],status:"todo"},
{cat:"6. P2P Swaps",planEvent:"p2p_swap_created",planParams:["offer_asset","want_asset","amount_usd","is_public"],purpose:"P2P creation",platform:"mp",curEvent:"otc_deal_initiated",curParams:[{n:"token_from",s:"orange",map:"offer_asset"},{n:"token_to",s:"orange",map:"want_asset"},{n:"amount_from",s:"orange",map:"amount_usd"},{n:"amount_to",s:"blue"},{n:"order_expiry_time",s:"blue"}],missing:["is_public"],status:"partial",pr:true},
{cat:"6. P2P Swaps",planEvent:"p2p_swap_shared",planParams:["share_method"],purpose:"Distribution",platform:"mp",curEvent:null,curParams:[],missing:["share_method"],status:"todo"},
{cat:"6. P2P Swaps",planEvent:"p2p_swap_viewed",planParams:["viewer_is_creator","swap_age"],purpose:"P2P discovery",platform:"mp",curEvent:null,curParams:[],missing:["viewer_is_creator","swap_age"],status:"todo"},
{cat:"6. P2P Swaps",planEvent:"p2p_swap_accepted",planParams:["offer_asset","want_asset","amount_usd","time_to_accept"],purpose:"P2P success",platform:"mp",curEvent:"otc_confirmed",curParams:[{n:"success",s:"blue"}],missing:["offer_asset","want_asset","amount_usd","time_to_accept"],status:"partial",pr:true},
{cat:"6. P2P Swaps",planEvent:"p2p_swap_cancelled",planParams:["reason","age_hours"],purpose:"P2P lifecycle",platform:"mp",curEvent:null,curParams:[],missing:["reason","age_hours"],status:"todo"},
{cat:"6. P2P Swaps",planEvent:"p2p_swap_expired",planParams:["offer_asset","want_asset"],purpose:"Unfulfilled swaps",platform:"mp",curEvent:null,curParams:[],missing:["offer_asset","want_asset"],status:"todo"},
{cat:"7. Gift Links",planEvent:"gift_link_created",planParams:["asset","amount_usd","message_added"],purpose:"Gift creation",platform:"mp",curEvent:"gift_created",curParams:[{n:"gift_token",s:"orange",map:"asset"},{n:"gift_amount",s:"orange",map:"amount_usd"},{n:"has_message",s:"orange",map:"message_added"}],missing:[],status:"done",pr:true},
{cat:"7. Gift Links",planEvent:"gift_link_shared",planParams:["share_method"],purpose:"Distribution channel",platform:"mp",curEvent:"gift_link_shared",curParams:[{n:"share_method",s:"green"},{n:"gift_token",s:"blue"}],missing:[],status:"done",pr:true},
{cat:"7. Gift Links",planEvent:"gift_link_viewed",planParams:["viewer_has_account","link_age_hours"],purpose:"Gift discovery",platform:"mp",curEvent:"gift_link_viewed",curParams:[{n:"viewer_has_account",s:"green"},{n:"gift_token",s:"blue"}],missing:["link_age_hours"],status:"partial",pr:true},
{cat:"7. Gift Links",planEvent:"gift_link_claimed",planParams:["asset","amount_usd","claimer_is_new_user"],purpose:"Key viral metric",platform:"mp",curEvent:"gift_claimed",curParams:[{n:"gift_token",s:"orange",map:"asset"},{n:"gift_amount",s:"orange",map:"amount_usd"}],missing:["claimer_is_new_user"],status:"partial",pr:true},
{cat:"7. Gift Links",planEvent:"gift_link_claim_to_signup",planParams:["time_to_create_account"],purpose:"Viral conversion",platform:"mp",curEvent:null,curParams:[],missing:["time_to_create_account"],status:"todo"},
{cat:"7. Gift Links",planEvent:"gift_link_expired",planParams:["asset","amount_usd","was_viewed"],purpose:"Unclaimed gifts",platform:"mp",curEvent:null,curParams:[],missing:["asset","amount_usd","was_viewed"],status:"todo"},
{cat:"7. Gift Links",planEvent:"gift_link_refunded",planParams:["asset","amount_usd","reason"],purpose:"Gift lifecycle",platform:"mp",curEvent:"gift_link_refunded",curParams:[{n:"gift_token",s:"orange",map:"asset"},{n:"gift_amount",s:"orange",map:"amount_usd"},{n:"reason",s:"green"}],missing:[],status:"done",pr:true},
{cat:"8. Contacts",planEvent:"contact_created",planParams:["chain_count","has_label"],purpose:"Contact adoption",platform:"mp",curEvent:null,curParams:[],missing:["chain_count","has_label"],status:"todo"},
{cat:"8. Contacts",planEvent:"contact_used",planParams:["action_type"],purpose:"Contact utility",platform:"mp",curEvent:null,curParams:[],missing:["action_type"],status:"todo"},
{cat:"8. Contacts",planEvent:"contact_edited",planParams:["field_changed"],purpose:"Contact maintenance",platform:"mp",curEvent:null,curParams:[],missing:["field_changed"],status:"todo"},
{cat:"8. Contacts",planEvent:"contact_deleted",planParams:["had_transactions"],purpose:"Contact lifecycle",platform:"mp",curEvent:null,curParams:[],missing:["had_transactions"],status:"todo"},
{cat:"8. Contacts",planEvent:"address_autocompleted",planParams:["from_contact","action_type"],purpose:"UX validation",platform:"mp",curEvent:null,curParams:[],missing:["from_contact","action_type"],status:"todo"},
{cat:"9. Engagement & Retention",planEvent:"session_start",planParams:["days_since_last_session","account_balance_usd","auth_method"],purpose:"Return visits",platform:"mp",curEvent:null,curParams:[],missing:["days_since_last_session","account_balance_usd","auth_method"],status:"todo"},
{cat:"9. Engagement & Retention",planEvent:"feature_discovered",planParams:["feature_name","discovery_method"],purpose:"Feature awareness",platform:"mp",curEvent:null,curParams:[],missing:["feature_name","discovery_method"],status:"todo"},
{cat:"9. Engagement & Retention",planEvent:"account_balance_viewed",planParams:["total_balance_usd","asset_count"],purpose:"Engagement signal",platform:"mp",curEvent:null,curParams:[],missing:["total_balance_usd","asset_count"],status:"todo"},
{cat:"9. Engagement & Retention",planEvent:"transaction_history_viewed",planParams:["filter_applied"],purpose:"Engagement signal",platform:"mp",curEvent:null,curParams:[],missing:["filter_applied"],status:"todo"},
{cat:"9. Engagement & Retention",planEvent:"settings_changed",planParams:["setting_name","new_value"],purpose:"Customization",platform:"mp",curEvent:null,curParams:[],missing:["setting_name","new_value"],status:"todo"},
{cat:"10. Errors & Friction",planEvent:"error_displayed",planParams:["error_type","error_code","page","action"],purpose:"Error frequency",platform:"mp",curEvent:null,curParams:[],missing:["error_type","error_code","page","action"],status:"todo"},
{cat:"10. Errors & Friction",planEvent:"help_clicked",planParams:["context","page"],purpose:"Confusion points",platform:"mp",curEvent:null,curParams:[],missing:["context","page"],status:"todo"},
{cat:"10. Errors & Friction",planEvent:"transaction_timeout",planParams:["action_type","wait_time"],purpose:"Performance issues",platform:"mp",curEvent:null,curParams:[],missing:["action_type","wait_time"],status:"todo"},
{cat:"10. Errors & Friction",planEvent:"unsupported_chain_selected",planParams:["chain_requested"],purpose:"Feature gaps",platform:"mp",curEvent:null,curParams:[],missing:["chain_requested"],status:"todo"},
{cat:"10. Errors & Friction",planEvent:"insufficient_balance_error",planParams:["action_type","shortfall_usd"],purpose:"Balance issues",platform:"mp",curEvent:null,curParams:[],missing:["action_type","shortfall_usd"],status:"todo"},
];

D.forEach((d,i)=>{d.id=i+1;});

function pHTML(p){
  if(p==='mp')return'<span class="ptag ptag-mp">Mixpanel</span>';
  if(p==='ga')return'<span class="ptag ptag-ga">GA4</span>';
  if(p==='both')return'<span class="ptag ptag-mp">Mixpanel</span> <span class="ptag ptag-ga">GA4</span>';
  return'';
}
function rP(p){
  if(typeof p==='string')return`<span class="param param-gray">${p}</span>`;
  if(p.s==='green')return`<span class="param param-green">${p.n}</span>`;
  if(p.s==='orange')return`<span class="param param-orange" title="Plan: ${p.map}">${p.n} ← ${p.map}</span>`;
  if(p.s==='blue')return`<span class="param param-blue" title="Extra">${p.n}<sup>+</sup></span>`;
  return`<span class="param param-gray">${p.n}</span>`;
}
function rRow(d,i){
  const ck=d.status==='done'?'checked':'';
  const rc=d.status==='done'?'row-done':d.status==='partial'?'row-partial':'row-todo';
  const bc=d.status==='done'?'badge-done':d.status==='partial'?'badge-partial':'badge-todo';
  const bt=d.status==='done'?'Done':d.status==='partial'?'Partial':'To do';
  const ec=!d.curEvent?'':(d.curEvent===d.planEvent?'cn-match':'cn-diff');
  const ce=d.curEvent?`<span class="current-name ${ec}">${d.curEvent}</span>`:'<span class="not-impl">—</span>';
  const cp=d.curParams.length?d.curParams.map(rP).join(' '):(d.curEvent?'':'<span class="not-impl">—</span>');
  const mp=d.missing.length?d.missing.map(m=>`<span class="param param-red">${m}</span>`).join(' '):'<span class="complete-mark">✓</span>';
  const pp=d.planParams.map(p=>`<span class="param param-gray">${p}</span>`).join(' ');
  const prBadge=d.pr?'<span class="badge badge-pr">Yes</span>':'<span class="badge-pr-no">—</span>';
  return`<tr class="${rc}" data-status="${d.status}" data-idx="${i}"><td><input type="checkbox" class="cb" ${ck} data-idx="${i}"></td><td style="color:#9ca3af;font-size:10px;text-align:center">${d.id}</td><td><span class="badge ${bc}" data-idx="${i}">${bt}</span></td><td><span class="ev-name">${d.planEvent}</span></td><td>${pp}</td><td style="white-space:nowrap">${pHTML(d.platform)}</td><td>${ce}</td><td>${cp}</td><td>${mp}</td><td style="text-align:center">${prBadge}</td></tr>`;
}
function render(f){
  const tb=document.getElementById('tbody');let h='',lc='',n=0;
  const cs={};D.forEach(d=>{if(!cs[d.cat])cs[d.cat]={done:0,partial:0,todo:0,t:0};cs[d.cat][d.status]++;cs[d.cat].t++;});
  D.forEach((d,i)=>{if(f==='pr'&&!d.pr)return;if(f!=='all'&&f!=='pr'&&d.status!==f)return;if(d.cat!==lc){lc=d.cat;const s=cs[d.cat];const p=Math.round(((s.done+s.partial*0.5)/s.t)*100);h+=`<tr class="cat-row"><td colspan="10">${d.cat} <span style="float:right;font-weight:600;font-size:11px;color:${p===100?'#16a34a':p>0?'#d97706':'#9ca3af'}">${p}% &mdash; ${s.done} of ${s.t} done</span></td></tr>`;}h+=rRow(d,i);n++;});
  tb.innerHTML=h;updP();document.getElementById('filterCount').textContent=`Showing ${n} of ${D.length}`;
}
function updP(){
  const dn=D.filter(d=>d.status==='done').length,pt=D.filter(d=>d.status==='partial').length,td=D.length-dn-pt;
  const pr=D.filter(d=>d.pr).length;
  const pc=Math.round(((dn+pt*0.5)/D.length)*100);
  document.getElementById('statDone').textContent=dn;document.getElementById('statPartial').textContent=pt;
  document.getElementById('statTodo').textContent=td;document.getElementById('statPct').textContent=pc+'%';
  document.getElementById('statPR').textContent=pr;
  document.getElementById('segDone').style.width=(dn/D.length*100)+'%';
  document.getElementById('segPartial').style.width=(pt/D.length*100)+'%';
  document.getElementById('progressText').textContent=`${dn} done · ${pt} partial · ${td} to do`;
}
const rerender=()=>render(document.querySelector('.filter-btn.active').dataset.filter);
const cycle={todo:'partial',partial:'done',done:'todo'};
document.querySelectorAll('.filter-btn').forEach(b=>{b.addEventListener('click',()=>{document.querySelectorAll('.filter-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');rerender();});});
document.getElementById('tbody').addEventListener('change',e=>{if(e.target.classList.contains('cb')){const i=parseInt(e.target.dataset.idx);D[i].status=e.target.checked?'done':(D[i].curEvent?'partial':'todo');rerender();}});
document.getElementById('tbody').addEventListener('click',e=>{const b=e.target.closest('.badge');if(b&&b.dataset.idx!=null){const i=parseInt(b.dataset.idx);D[i].status=cycle[D[i].status];rerender();}});
render('all');
</script>
</body>
</html>
